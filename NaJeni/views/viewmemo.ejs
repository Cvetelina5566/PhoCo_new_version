<!-- addmemo.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>Add Memo</title>
    <style>
      #upload-button {
        background-color: green;
      }

      #upload-button.uploaded {
        background-color: gray;
      }
    </style>
  </head>
  <body>
    <a href="http://localhost:4000/main"><button>Go back</button></a>
    <h1>Memories of <%=person%></h1>
    <% if (Object.keys(memoriesArr).length > 0) { %>
      <% Object.keys(memoriesArr).forEach((key) => { %>
        <h2><%= key %></h2>
        <img src="<%= memoriesArr[key] %>" alt="Image" width="300px" height="250px">
        <h3>Comments</h3>
      <% }) %>
    <% } else { %>
      <p>No memories found.</p>
    <% } %>
    
    <h2>Add Memo</h2>
    <p>Enter a memo and upload an image</p>
    <input type="file" id="image-input" style="display:none;">
    <button id="upload-button">Upload Image</button>
    <script>
      document.getElementById('upload-button').addEventListener('click', () => {
        document.getElementById('image-input').click();
      });
      document.getElementById('image-input').addEventListener('change', () => {
        const file = document.getElementById('image-input').files[0];
        const formData = new FormData();
        formData.append('image', file);
        document.getElementById('upload-button').classList.add('uploaded');
      });
    </script>

<input type="text" id="text-input">
<button id="submit-button">Add Memo</button>
<script>
  document.getElementById('submit-button').addEventListener('click', () => {
    const text = document.getElementById('text-input').value;
    if (!text) {
      alert('Please enter some text.');
      return;
    }
    
    const file = document.getElementById('image-input').files[0];
    if (!file) {
      alert('Please upload an image.');
      return;
    }
    
    const formData = new FormData();
    formData.append('text', text);
    formData.append('memoimage', file);
    formData.append('person', '<%=person%>');
    formData.append('albname', '<%=albumname%>');

    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/addmemopost');
    xhr.addEventListener('load', (event) => {
      // Handle the server response here.
      if (xhr.status === 200) {
        alert('Memo added successfully.');
        window.location.href = '/viewalbum/viewpeople/memo?person=<%=person%>&name=<%=albumname%>';
      } else {
        alert('Error adding memo.');
      }
    });
    xhr.send(formData);
  });
</script>

</script>

  </body>
</html>
